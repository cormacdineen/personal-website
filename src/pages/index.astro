---
import { getCollection } from "astro:content";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import Card from "@/components/Card.astro";
import Footer from "@/components/Footer.astro";
import Header from "@/components/Header.astro";
import Hr from "@/components/Hr.astro";
import LinkButton from "@/components/LinkButton.astro";
import Socials from "@/components/Socials.astro";
import StructuredData from "@/components/StructuredData.astro";
import { SITE, SOCIALS } from "@/config";
import Layout from "@/layouts/Layout.astro";
import getSortedPosts from "@/utils/getSortedPosts";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const recentPosts = sortedPosts.slice(0, 3);
---

<Layout>
  <StructuredData type="WebSite" data={{}} />
  <StructuredData type="Person" data={{}} />
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-8 pb-6">
      <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6">
        <img
          src="/assets/img/covers/PXL_20250702_131936492.jpg"
          alt="Cormac Dineen"
          class="w-40 rounded-xl object-cover shrink-0"
        />
        <div class="text-center sm:text-left">
          <h1 class="my-2 inline-block text-3xl font-bold sm:my-4 sm:text-4xl">
            Cormac Dineen
          </h1>
          <p class="text-lg text-foreground/80 mt-2">
            Mechanical engineering PhD student
          </p>
          <p class="mt-4 max-w-xl">
            Welcome to my site. I write about my research,
            share photography, and review my cultural stew (books, TV, films, sport and food).
          </p>
          {
            SOCIALS.filter((social) => social.active).length > 0 && (
              <div class="mt-6 flex flex-row items-center justify-center sm:justify-start">
                <Socials />
              </div>
            )
          }
        </div>
      </div>
    </section>

    <Hr />

    <section class="pt-8 pb-6">
      <h2 class="text-2xl font-semibold tracking-wide mb-6">Explore</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <a href="/blog" class="block p-4 rounded-lg border border-border hover:border-accent transition-colors">
          <h3 class="font-semibold text-accent">Blog</h3>
          <p class="text-sm text-foreground/60 mt-1">Research updates and writing</p>
        </a>
        <a href="/photography" class="block p-4 rounded-lg border border-border hover:border-accent transition-colors">
          <h3 class="font-semibold text-accent">Photography</h3>
          <p class="text-sm text-foreground/60 mt-1">A gallery of photographs</p>
        </a>
        <a href="/recommendations" class="block p-4 rounded-lg border border-border hover:border-accent transition-colors">
          <h3 class="font-semibold text-accent">Cultural stew</h3>
          <p class="text-sm text-foreground/60 mt-1">Books, podcasts, films, and more</p>
        </a>
        <a href="/about" class="block p-4 rounded-lg border border-border hover:border-accent transition-colors">
          <h3 class="font-semibold text-accent">About</h3>
          <p class="text-sm text-foreground/60 mt-1">Biography and contact</p>
        </a>
      </div>
    </section>

    {
      recentPosts.length > 0 && (
        <>
          <Hr />
          <section id="recent-posts" class="pt-8 pb-6">
            <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
            <ul>
              {recentPosts.map((data) => (
                <Card variant="h3" {...data} showImage={false} />
              ))}
            </ul>
          </section>
          <div class="my-8 text-center">
            <LinkButton href="/blog">
              All Posts
              <IconArrowRight class="inline-block" />
            </LinkButton>
          </div>
        </>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
